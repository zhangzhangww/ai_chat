import{l as q,_ as I,r as l,o as O,m as R,p as E,a as c,b as o,f as U,q as f,v as F,F as T,g as w,s as J,x as P,j as u,t as Y,n as A,e as D}from"./index-BAb06sIO.js";import{m as k}from"./marked.esm-DK8KC6kv.js";const $="/assets/aiIcon-fvBYh7Ir.png",G=q("userMsgStore",{persist:!0,state:()=>({list:[{role:"assistant",content:"你好！很高兴见到你。有什么我可以帮助你的吗？如果你有任何问题，请随时告诉我。我会尽力提供帮助。",reasoning_content:"",status:1}],maxContextLength:6}),getters:{formattedContext:e=>e.list.slice(-e.maxContextLength).map(s=>({role:s.role,content:s.content}))},actions:{userAddMsg(e){this.list.push({role:"user",content:e,reasoning_content:"",status:2})},clearMessages(){this.list=[{role:"assistant",content:"你好！很高兴见到你。有什么我可以帮助你的吗？如果你有任何问题，请随时告诉我。我会尽力提供帮助。",reasoning_content:"",status:1}]},addAssistantMessage(){this.list.push({role:"assistant",content:"",reasoning_content:"",status:1})},aiAddContent({content:e,reasoning_content:s}){const n=this.list[this.list.length-1];!n||n.role!=="assistant"||(n.content+=e||"",n.reasoning_content+=s||"")},completeAiMessage(){const e=this.list[this.list.length-1];!e||e.role!=="assistant"||(e.status=2,console.log(e.content),e.content=k(e.content),console.log(e.content))},clearPendingMessages(){this.list=this.list.filter(e=>e.status===2)}}}),K={class:"ai_content"},Q={class:"history-control"},W=["value"],X={class:"message",id:"message-box"},Z={class:"role-content",id:"role-content"},ee={key:0,class:"role-img",src:$,style:{"margin-right":"8px"}},te=["innerHTML"],se=["innerHTML"],ne={class:"footer"},oe={__name:"home",setup(e){const s=G();l(!1);const n=l(""),g=l("deepseek-ai/DeepSeek-R1"),x=l(!1),h=l(null);let m=new AbortController;const L=l([{value:"deepseek-ai/DeepSeek-R1",text:"deepseek-ai/DeepSeek-R1"},{value:"deepseek-ai/DeepSeek-V3",text:"deepseek-ai/DeepSeek-V3"}]),r=l([...s.list]);O(()=>{h.value=document.getElementById("role-content"),k.setOptions({highlight:a=>hljs.highlightAuto(a).value,sanitize:!0}),M()}),R(()=>{m.abort()});const V=a=>k(a),M=()=>{E(()=>{h.value&&setTimeout(()=>{h.value.scrollTo({top:h.value.scrollHeight,behavior:"smooth"})},0)})},H=()=>{confirm("确定要清空所有聊天记录吗？")&&(s.clearMessages(),r.value=[])},v=l(!1),B=async()=>{if(n.value.trim()&&!v.value){v.value=!0;try{x.value=!0,m=new AbortController,s.userAddMsg(n.value),r.value=[...s.list],s.addAssistantMessage("",""),r.value=s.list;const a=s.formattedContext,p=(await fetch("https://api.siliconflow.cn/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer sk-ikbdqintkdjvvzouoofbxilnrhcordukkducqdmhttwzhwtj","Content-Type":"application/json"},body:JSON.stringify({model:g.value,stream:!0,temperature:.7,top_p:.7,top_k:50,frequency_penalty:.5,n:1,messages:[{role:"system",content:"请根据对话历史提供专业准确的回答"},...a,{role:"user",content:n.value}]}),signal:m.signal})).body.getReader(),t=new TextDecoder;let d="";for(;;){const{done:j,value:z}=await p.read();if(j)break;d+=t.decode(z,{stream:!0});const b=d.split("data: ");d=b.pop()||"";for(const N of b){const y=N.trim();if(y)try{const C=JSON.parse(y).choices[0].delta,_=r.value[r.value.length-1];_.role==="assistant"&&(_.content+=C.content||"",_.reasoning_content+=C.reasoning_content||"",r.value=[...s.list],M())}catch(S){console.error("解析错误:",S)}}}}catch(a){a.name!=="AbortError"&&console.error("请求失败:",a)}finally{x.value=!1,n.value="",v.value=!1}}};return(a,i)=>{const p=P("highlight");return u(),c("div",K,[o("div",Q,[o("span",null,[i[2]||(i[2]=U(" 模型： ")),f(o("select",{"onUpdate:modelValue":i[0]||(i[0]=t=>g.value=t),class:"model-select"},[(u(!0),c(T,null,w(L.value,t=>(u(),c("option",{value:t.value},Y(t.text),9,W))),256))],512),[[F,g.value]])]),o("button",{class:"clear-btn",onClick:H},"清空记录")]),o("div",X,[o("div",Z,[(u(!0),c(T,null,w(r.value,(t,d)=>(u(),c("div",{key:d,class:A({user:t.role==="user",assistant:t.role==="assistant"})},[t.role==="assistant"?(u(),c("img",ee)):D("",!0),o("div",null,[t.role==="assistant"?(u(),c("div",{key:0,class:"content-html ass1",innerHTML:t.reasoning_content},null,8,te)):D("",!0),f(o("div",{class:A(["content-html",t.role==="assistant"?"ass":"us"]),innerHTML:V(t.content)},null,10,se),[[p]])])],2))),128))])]),o("div",ne,[f(o("textarea",{rows:"5",placeholder:"请输入问题",class:"text","onUpdate:modelValue":i[1]||(i[1]=t=>n.value=t)},null,512),[[J,n.value]]),o("button",{class:"btn",onClick:B},"发送")])])}}},re=I(oe,[["__scopeId","data-v-cdc0495d"]]);export{re as default};
