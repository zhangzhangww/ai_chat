import{h as k}from"./request-C9YwD_7X.js";/* empty css                 */import{_ as C,r as p,o as I,a as g,b as c,h as l,w as r,P as F,Q as K,V as _,D as B,f as R,O as U,E as f,W as N,u as j,j as v}from"./index-Bgxnn_i8.js";const q=()=>k.get("/chat/captchaImage"),L=h=>k.post("/chat/login",h),M={class:"login-container"},D={class:"login-box"},O={class:"captcha-container"},P=["src"],Q={key:1,class:"loading-text"},T={__name:"login",setup(h){const x=j(),b=p(null),a=p({username:"",password:"",code:"",uuid:""}),n=p(""),m=p(!1),E={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},w=async()=>{try{const o=await q();console.log("获取验证码成功:",o),a.value.uuid=o.data.uuid,n.value="data:image/jpeg;base64,"+o.data.img}catch(o){console.error("获取验证码失败:",o),f.error("获取验证码失败，请重试"),n.value=""}},y=()=>{n.value="",w()},i=async()=>{var o,e,t;try{if(m.value=!0,!await((o=b.value)==null?void 0:o.validate()))return;const d=(await L(a.value)).data.token;if(d)N.set("token",d),x.push("/admin/account"),f.success("登录成功");else throw new Error("登录失败，未获取到token")}catch(s){console.error("登录失败:",s),f.error(((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||"登录失败，请检查用户名、密码和验证码"),y()}finally{m.value=!1}};return I(()=>{w()}),(o,e)=>{const t=K,s=F,V=B,d=U;return v(),g("div",M,[c("div",D,[l(d,{ref_key:"loginFormRef",ref:b,model:a.value,rules:E,class:"login-form","label-position":"top"},{default:r(()=>[l(s,{prop:"username",label:"用户名"},{default:r(()=>[l(t,{modelValue:a.value.username,"onUpdate:modelValue":e[0]||(e[0]=u=>a.value.username=u),placeholder:"请输入用户名","prefix-icon":"User",clearable:"",onKeyup:_(i,["enter"])},null,8,["modelValue"])]),_:1}),l(s,{prop:"password",label:"密码"},{default:r(()=>[l(t,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=u=>a.value.password=u),type:"password",placeholder:"请输入密码","prefix-icon":"Lock","show-password":"",clearable:"",onKeyup:_(i,["enter"])},null,8,["modelValue"])]),_:1}),l(s,{prop:"code",label:"验证码"},{default:r(()=>[c("div",O,[l(t,{modelValue:a.value.code,"onUpdate:modelValue":e[2]||(e[2]=u=>a.value.code=u),placeholder:"请输入验证码","prefix-icon":"Key",class:"captcha-input",clearable:"",onKeyup:_(i,["enter"])},null,8,["modelValue"]),c("div",{class:"captcha-image",onClick:y},[n.value?(v(),g("img",{key:0,src:n.value,alt:"验证码"},null,8,P)):(v(),g("span",Q,"加载验证码..."))])])]),_:1}),l(s,null,{default:r(()=>[l(V,{type:"primary",class:"login-btn",loading:m.value,onClick:i},{default:r(()=>e[3]||(e[3]=[R(" 登 录 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),e[4]||(e[4]=c("div",{class:"login-footer"},[c("p",null,"版权所有 © 河南省气象局《气象与环境科学》编辑部")],-1))])}}},A=C(T,[["__scopeId","data-v-723c6925"]]);export{A as default};
