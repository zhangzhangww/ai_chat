import{h as _}from"./request-C9YwD_7X.js";/* empty css                        *//* empty css                  *//* empty css                 */import{r as g,T as R,k as z,j as C,w as d,h as e,P as I,e as S,Q as O,R as K,U as P,D as L,f as v,a as T,t as $,C as M,E as c,_ as q,A as B,o as Q,b as k,N as G,V as H,L as J,M as W,S as X}from"./index-BkjHq5tH.js";const Y={key:0,class:"el-upload__tip"},Z={__name:"ReaderForm",props:{modelValue:Boolean,formData:Object,isEdit:Boolean},emits:["update:modelValue","submit"],setup(n,{emit:h}){const f=n,b=h,m=g(!1),V=g(null),i=g([]),a=g({readerName:"",author:"",unit:"",issue:"",citedArticle:"",digitalObjectldentifier:"",chineseAbstract:"",chineseKeyword:"",englishAbstract:"",englishKeyword:"",readerFile:null,readerld:""});R(()=>f.modelValue,p=>{m.value=p,p&&(a.value={...f.formData},i.value=[])}),R(m,p=>{b("update:modelValue",p)});const U=p=>{a.value.readerFile=p.raw},E=()=>{V.value.validate(async p=>{if(p){const l=new FormData;for(const u in a.value)a.value[u]!==null&&a.value[u]!==void 0&&l.append(u,a.value[u]);b("submit",l)}else c.error("请填写完整信息")})},A=()=>{V.value.resetFields(),i.value=[]};return(p,l)=>{const u=K,r=O,o=L,y=P,x=I,F=M;return C(),z(F,{title:n.isEdit?"编辑读本":"添加读本",modelValue:m.value,"onUpdate:modelValue":l[12]||(l[12]=t=>m.value=t),width:"50%",onClose:A},{footer:d(()=>[e(o,{onClick:l[11]||(l[11]=t=>m.value=!1)},{default:d(()=>l[14]||(l[14]=[v("取消")])),_:1}),e(o,{type:"primary",onClick:E},{default:d(()=>l[15]||(l[15]=[v("确定")])),_:1})]),default:d(()=>[e(x,{model:a.value,ref_key:"formRef",ref:V,"label-width":"120px"},{default:d(()=>[e(r,{label:"读本名称",prop:"readerName",rules:[{required:!0,message:"请输入读本名称"}]},{default:d(()=>[e(u,{modelValue:a.value.readerName,"onUpdate:modelValue":l[0]||(l[0]=t=>a.value.readerName=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"作者",prop:"author"},{default:d(()=>[e(u,{modelValue:a.value.author,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value.author=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"单位",prop:"unit"},{default:d(()=>[e(u,{modelValue:a.value.unit,"onUpdate:modelValue":l[2]||(l[2]=t=>a.value.unit=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"期号",prop:"issue"},{default:d(()=>[e(u,{modelValue:a.value.issue,"onUpdate:modelValue":l[3]||(l[3]=t=>a.value.issue=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"引用本文",prop:"citedArticle"},{default:d(()=>[e(u,{modelValue:a.value.citedArticle,"onUpdate:modelValue":l[4]||(l[4]=t=>a.value.citedArticle=t),type:"textarea"},null,8,["modelValue"])]),_:1}),e(r,{label:"读本标识符",prop:"digitalObjectldentifier",rules:[{required:!0,message:"请输入读本标识符"}]},{default:d(()=>[e(u,{modelValue:a.value.digitalObjectldentifier,"onUpdate:modelValue":l[5]||(l[5]=t=>a.value.digitalObjectldentifier=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"中文摘要",prop:"chineseAbstract"},{default:d(()=>[e(u,{modelValue:a.value.chineseAbstract,"onUpdate:modelValue":l[6]||(l[6]=t=>a.value.chineseAbstract=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(r,{label:"中文关键词",prop:"chineseKeyword"},{default:d(()=>[e(u,{modelValue:a.value.chineseKeyword,"onUpdate:modelValue":l[7]||(l[7]=t=>a.value.chineseKeyword=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"英文摘要",prop:"englishAbstract"},{default:d(()=>[e(u,{modelValue:a.value.englishAbstract,"onUpdate:modelValue":l[8]||(l[8]=t=>a.value.englishAbstract=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(r,{label:"英文关键词",prop:"englishKeyword"},{default:d(()=>[e(u,{modelValue:a.value.englishKeyword,"onUpdate:modelValue":l[9]||(l[9]=t=>a.value.englishKeyword=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"文件",prop:"readerFile",rules:[{required:!n.isEdit,message:"请选择文件"}]},{default:d(()=>[e(y,{class:"upload-demo","auto-upload":!1,limit:1,"on-change":U,"file-list":i.value},{tip:d(()=>{var t,N;return[n.isEdit?(C(),T("div",Y," 当前文件: "+$((N=(t=a.value.filePath)==null?void 0:t.split("/"))==null?void 0:N.pop()),1)):S("",!0)]}),default:d(()=>[e(o,{type:"primary"},{default:d(()=>l[13]||(l[13]=[v("选择文件")])),_:1})]),_:1},8,["file-list"])]),_:1},8,["rules"]),n.isEdit?(C(),z(r,{key:0,label:"读本ID",prop:"readerld"},{default:d(()=>[e(u,{modelValue:a.value.readerld,"onUpdate:modelValue":l[10]||(l[10]=t=>a.value.readerld=t),disabled:""},null,8,["modelValue"])]),_:1})):S("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}},w={getReaderList(n){return _.get("/chat/reader/list",{params:n})},addReader(n){return _.post("/chat/reader",n,{headers:{"Content-Type":"multipart/form-data"}})},updateReader(n){return _.put("/chat/reader",n,{headers:{"Content-Type":"multipart/form-data"}})},deleteReader(n){return _.delete(`/chat/reader/${n}`)},batchDeleteReader(n){return _.delete("/chat/reader",{data:{ids:n}})},getFileUrl(n){return`${_.defaults.baseURL}/chat/reader/viewFile?readerId=${n}`}},ee={class:"content-item"},le={class:"header"},ae={class:"search-bar"},te={class:"pagination"},oe={__name:"readerList",setup(n){const h=g([]),f=g(!1),b=g(!1),m=g({}),V=B({readerName:"",pageNum:1,pageSize:10}),i=B({pageNum:1,pageSize:10,total:0}),a=async()=>{try{const r={readerName:V.readerName,pageNum:i.pageNum,pageSize:i.pageSize},o=await w.getReaderList(r);h.value=o.data.rows||[],i.total=o.data.total||0}catch(r){c.error("获取数据失败"),console.error(r)}},U=async r=>{try{if(!r.readerId){c.warning("读本ID不存在");return}const o=w.getFileUrl(r.readerId);window.open(o)}catch(o){c.error("查看文件失败"),console.error(o)}},E=()=>{m.value={readerName:"",author:"",unit:"",issue:"",citedArticle:"",digitalObjectldentifier:"",chineseAbstract:"",chineseKeyword:"",englishAbstract:"",englishKeyword:"",readerFile:null},b.value=!1,f.value=!0},A=r=>{m.value={...r},b.value=!0,f.value=!0},p=async r=>{try{b.value?(await w.updateReader(r),c.success("更新成功")):(await w.addReader(r),c.success("添加成功")),f.value=!1,a()}catch(o){c.error("操作失败"),console.error(o)}},l=r=>{console.log(r),X.confirm("确认删除该读本吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await w.deleteReader(r),c.success("删除成功"),a()}catch(o){c.error("删除失败"),console.error(o)}}).catch(()=>{})},u=()=>{a()};return Q(()=>{a()}),(r,o)=>{const y=L,x=K,F=H,t=G,N=J,j=W;return C(),T("div",ee,[k("div",le,[o[5]||(o[5]=k("h2",null,"读本列表",-1)),e(y,{type:"primary",onClick:E},{default:d(()=>o[4]||(o[4]=[v("添加读本")])),_:1})]),k("div",ae,[e(x,{modelValue:V.readerName,"onUpdate:modelValue":o[0]||(o[0]=s=>V.readerName=s),placeholder:"读本名称",style:{width:"200px"}},null,8,["modelValue"]),e(y,{type:"primary",onClick:a},{default:d(()=>o[6]||(o[6]=[v("搜索")])),_:1})]),e(N,{data:h.value,border:"",style:{width:"100%","max-height":"80%",overflow:"auto"}},{default:d(()=>[e(t,{prop:"readerName",label:"读本名称"},{default:d(({row:s})=>[e(F,{type:"primary",onClick:D=>U(s)},{default:d(()=>[v($(s.readerName),1)]),_:2},1032,["onClick"])]),_:1}),e(t,{prop:"author",label:"作者"}),e(t,{prop:"unit",label:"单位"}),e(t,{prop:"issue",label:"期号"}),e(t,{prop:"clickNumber",label:"点击数"}),e(t,{prop:"downloadNumber",label:"下载数"}),e(t,{prop:"uploadTime",label:"上传时间"}),e(t,{label:"操作",width:"200"},{default:d(({row:s})=>[e(y,{size:"small",onClick:D=>A(s)},{default:d(()=>o[7]||(o[7]=[v("编辑")])),_:2},1032,["onClick"]),e(y,{size:"small",type:"danger",onClick:D=>l(s.readerId)},{default:d(()=>o[8]||(o[8]=[v("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),k("div",te,[e(j,{background:"","current-page":i.pageNum,"onUpdate:currentPage":o[1]||(o[1]=s=>i.pageNum=s),"page-size":i.pageSize,"onUpdate:pageSize":o[2]||(o[2]=s=>i.pageSize=s),total:i.total,onCurrentChange:u,layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])]),e(Z,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=s=>f.value=s),"form-data":m.value,"is-edit":b.value,onSubmit:p},null,8,["modelValue","form-data","is-edit"])])}}},ie=q(oe,[["__scopeId","data-v-fdc6719b"]]);export{ie as default};
