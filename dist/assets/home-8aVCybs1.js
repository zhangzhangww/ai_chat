import{l as z,_ as J,r as l,o as R,H as T,m as F,p as U,a as c,b as a,f as j,q as A,v as P,F as C,g as S,s as W,j as u,t as X,n as L,e as w}from"./index-BkjHq5tH.js";import{m as O,M as G,a as K,p as Q}from"./purify.es-hQnOW41Q.js";const Y="/assets/aiIcon-JcS-qXok.png",Z=z("userMsgStore",{persist:!0,state:()=>({list:[{role:"assistant",content:"你好！很高兴见到你。有什么我可以帮助你的吗？如果你有任何问题，请随时告诉我。我会尽力提供帮助。",reasoning_content:"",status:1}],maxContextLength:6}),getters:{formattedContext:e=>e.list.slice(-e.maxContextLength).map(n=>({role:n.role,content:n.content}))},actions:{userAddMsg(e){this.list.push({role:"user",content:e,reasoning_content:"",status:2})},clearMessages(){this.list=[{role:"assistant",content:"你好！很高兴见到你。有什么我可以帮助你的吗？如果你有任何问题，请随时告诉我。我会尽力提供帮助。",reasoning_content:"",status:1}]},addAssistantMessage(){this.list.push({role:"assistant",content:"",reasoning_content:"",status:1})},aiAddContent({content:e,reasoning_content:n}){const r=this.list[this.list.length-1];!r||r.role!=="assistant"||(r.content+=e||"",r.reasoning_content+=n||"")},completeAiMessage(){const e=this.list[this.list.length-1];!e||e.role!=="assistant"||(e.status=2,console.log(e.content),e.content=O(e.content),console.log(e.content))},clearPendingMessages(){this.list=this.list.filter(e=>e.status===2)}}}),ee={class:"ai_content"},te={class:"history-control"},se=["value"],ne={class:"message",id:"message-box"},oe={class:"role-content",id:"role-content"},ae={key:0,class:"role-img",src:Y,style:{"margin-right":"8px"}},re=["innerHTML"],le=["innerHTML"],ie={class:"footer"},ce={__name:"home",setup(e){const n=Z();l(!1);const r=l(""),h=l("deepseek-chat"),_=l(!1),d=l(null);let m=new AbortController;const $=l([{value:"deepseek-chat",text:"deepseek-chat"}]),i=l([...n.list]);R(()=>{d.value=document.getElementById("role-content"),O.setOptions({highlight:o=>T.highlightAuto(o).value,sanitize:!0}),k()}),F(()=>{m.abort()});const H=new G({html:!1,xhtmlOut:!0,breaks:!0,linkify:!0,typographer:!0,highlight:(o,s)=>T.highlightAuto(o).value}).use(K,{throwOnError:!1,errorColor:"#cc0000",delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],strict:!1}),D=o=>{if(!o)return"";const s=H.render(String(o));return Q.sanitize(s,{ALLOWED_TAGS:["p","em","strong","code","pre","span","div","br","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","a","math","mrow","mi","mo","mn","msup","msub","mfrac","msqrt"],ALLOWED_ATTR:["class","style","href","target","rel","aria-hidden"],FORBID_ATTR:["onclick","onerror","onload"]})},k=()=>{U(()=>{d.value&&setTimeout(()=>{d.value.scrollTo({top:d.value.scrollHeight,behavior:"smooth"})},0)})},V=()=>{confirm("确定要清空所有聊天记录吗？")&&(n.clearMessages(),i.value=[])},g=l(!1),B=async()=>{const o=l(r.value);if(r.value="",!!o.value.trim()&&!g.value){g.value=!0;try{_.value=!0,m=new AbortController,n.userAddMsg(o.value),i.value=[...n.list],n.addAssistantMessage("",""),i.value=n.list;const s=n.formattedContext,p=(await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer sk-93078c38f7234d158c027743d4a07976","Content-Type":"application/json"},body:JSON.stringify({model:h.value,stream:!0,temperature:.7,top_p:.7,top_k:50,frequency_penalty:.5,n:1,messages:[{role:"system",content:"请根据对话历史提供专业准确的回答,所有涉及到数学公式的返回LaTeX格式，公式前后加上$$符号"},...s,{role:"user",content:o.value}]}),signal:m.signal})).body.getReader(),E=new TextDecoder;let v="";for(;;){const{done:q,value:I}=await p.read();if(q)break;v+=E.decode(I,{stream:!0});const y=v.split("data: ");v=y.pop()||"";for(const N of y){const M=N.trim();if(M)try{const x=JSON.parse(M).choices[0].delta,f=i.value[i.value.length-1];f.role==="assistant"&&(f.content+=x.content||"",f.reasoning_content+=x.reasoning_content||"",i.value=[...n.list],k())}catch(b){console.error("解析错误:",b)}}}}catch(s){s.name!=="AbortError"&&console.error("请求失败:",s)}finally{_.value=!1,g.value=!1}}};return(o,s)=>(u(),c("div",ee,[a("div",te,[a("span",null,[s[2]||(s[2]=j(" 模型： ")),A(a("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>h.value=t),class:"model-select"},[(u(!0),c(C,null,S($.value,t=>(u(),c("option",{value:t.value},X(t.text),9,se))),256))],512),[[P,h.value]])]),a("button",{class:"clear-btn",onClick:V},"清空记录")]),a("div",ne,[a("div",oe,[(u(!0),c(C,null,S(i.value,(t,p)=>(u(),c("div",{key:p,class:L({user:t.role==="user",assistant:t.role==="assistant"})},[t.role==="assistant"?(u(),c("img",ae)):w("",!0),a("div",null,[t.role==="assistant"?(u(),c("div",{key:0,class:"content-html ass1",innerHTML:t.reasoning_content},null,8,re)):w("",!0),a("div",{class:L(["content-html",t.role==="assistant"?"ass":"us"]),innerHTML:D(t.content)},null,10,le)])],2))),128))])]),a("div",ie,[A(a("textarea",{rows:"5",placeholder:"请输入问题",class:"text","onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t)},null,512),[[W,r.value]]),a("button",{class:"btn",onClick:B},"发送")])]))}},he=J(ce,[["__scopeId","data-v-a3d2c956"]]);export{he as default};
